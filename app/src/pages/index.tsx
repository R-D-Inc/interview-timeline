import { GetServerSideProps } from "next";
import Head from "next/head";
import Image from "next/image";
import { useEffect, useState } from "react";
import { fetchUsers } from "../libs/users";
import styles from "../styles/Home.module.css";

export type User = {
	id: string;
	name: string;
};

export default function Home(props: { users: User[] }) {
	const [page, setPage] = useState(0);
	// const [clientFetchedUser, setClientFetchedUser] = useState<User[]>([]);
	const handleBack = () => {
		if (page === 0) return;
		setPage(page - 1);
	};
	const handleNext = () => {
		setPage(page + 1);
	};
	const fetchedUser = props.users.slice(page * 10, page * 10 + 9);
	// useEffect(() => {
	// 	const fetchUserByPage = async (page) => {
	// 		const user = await fetchUsers(10, page);
	// 		setClientFetchedUser(user);
	// 	};
	// 	fetchUserByPage(page);
	// }, [page]);
	return (
		<div className={styles.container}>
			<Head>
				<title>Create Next App</title>
				<meta name='description' content='Generated by create next app' />
				<link rel='icon' href='/favicon.ico' />
			</Head>

			<main className={styles.main}>
				<h1 className={styles.title}>Welcome</h1>

				<button onClick={handleBack}>{"<<"}</button>
				<ul>
					{fetchedUser.map((user) => {
						return <li>{user.name}</li>;
					})}
				</ul>
				<button onClick={handleNext}>{">>"}</button>
			</main>

			<footer className={styles.footer}>
				<a
					href='https://vercel.com?utm_source=create-next-app&utm_medium=default-template&utm_campaign=create-next-app'
					target='_blank'
					rel='noopener noreferrer'
				>
					Powered by{" "}
					<span className={styles.logo}>
						<Image src='/vercel.svg' alt='Vercel Logo' width={72} height={16} />
					</span>
				</a>
			</footer>
		</div>
	);
}

export const getServerSideProps: GetServerSideProps = async () => {
	const users = await fetchUsers(100, 0);

	return {
		props: {
			users,
		},
	};
};
